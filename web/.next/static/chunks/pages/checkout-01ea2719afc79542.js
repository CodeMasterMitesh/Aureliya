(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{5338:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return t(8535)}])},3486:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});var n=t(5893);function a(e){let{as:r="button",variant:t="outline",className:a="",...s}=e;return(0,n.jsx)(r,{className:"".concat("inline-flex items-center justify-center rounded-md text-sm transition"," ").concat("solid"===t?"bg-blue-600 text-white hover:bg-blue-700 border border-blue-600":"border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-900"," ").concat(a),...s})}},8535:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return p}});var n=t(5893),a=t(7294),s=t(3486),l=t(3514),d=t(8145),i=t(4385),c=t(452);async function o(e){let{data:r}=await c.Z.post("/payments/intent",{orderId:e});return r}async function u(e){let{data:r}=await c.Z.post("/payments/confirm",{paymentId:e});return r}var m=t(1163);function p(){var e;let r=(0,l.a)(e=>e.token),t=(0,l.a)(e=>e.user),c=(0,d.j)(e=>e.items),p=(0,d.j)(e=>e.total()),b=(0,m.useRouter)(),[h,x]=(0,a.useState)(!1),[f,g]=(0,a.useState)({name:"",line1:"",city:"",zip:""}),[y,v]=(0,a.useState)(!0),[j,N]=(0,a.useState)(null);async function k(){if(!f.name||!f.line1||!f.city||!f.zip){alert("Please fill shipping address");return}x(!0);try{let e=await (0,i.LV)({address:f}),r=await o(e._id);await u(r.paymentId),b.push("/orders/success")}catch(e){alert("Payment failed. Please try again.")}finally{x(!1)}}return(0,a.useEffect)(()=>{var e,n;r&&(null==c?void 0:c.length)||b.push("/cart");let a=(null==t?void 0:null===(e=t.addresses)||void 0===e?void 0:e.find(e=>e.isDefault))||(null==t?void 0:null===(n=t.addresses)||void 0===n?void 0:n[0]);a&&(N(a._id),g({name:(null==t?void 0:t.name)||"",line1:a.line1||"",city:a.city||"",zip:a.zip||""}))},[r,null==c?void 0:c.length]),(0,n.jsxs)("section",{className:"container container-padding py-10",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Checkout"}),(0,n.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-[1fr_360px]",children:[(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-neutral-200/70 dark:border-neutral-800 p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Shipping Address"}),(null==t?void 0:null===(e=t.addresses)||void 0===e?void 0:e.length)>0&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm mb-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:y,onChange:e=>v(e.target.checked)})," Use saved address"]}),y&&(0,n.jsx)("div",{className:"space-y-2",children:t.addresses.map(e=>(0,n.jsxs)("label",{className:"block rounded-md border p-3 text-sm cursor-pointer ".concat(j===e._id?"border-blue-500":"border-neutral-300 dark:border-neutral-700"),children:[(0,n.jsx)("input",{type:"radio",name:"seladdr",checked:j===e._id,onChange:()=>{N(e._id),g({name:(null==t?void 0:t.name)||"",line1:e.line1||"",city:e.city||"",zip:e.zip||""})},className:"mr-2"}),e.label,": ",e.line1,", ",e.city," ",e.zip]},e._id))})]}),(0,n.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[(0,n.jsx)("input",{value:f.name,onChange:e=>g({...f,name:e.target.value}),placeholder:"Full name",className:"rounded-md border border-neutral-300 dark:border-neutral-700 bg-transparent px-3 py-2 text-sm"}),(0,n.jsx)("input",{value:f.line1,onChange:e=>g({...f,line1:e.target.value}),placeholder:"Address line",className:"rounded-md border border-neutral-300 dark:border-neutral-700 bg-transparent px-3 py-2 text-sm sm:col-span-2"}),(0,n.jsx)("input",{value:f.city,onChange:e=>g({...f,city:e.target.value}),placeholder:"City",className:"rounded-md border border-neutral-300 dark:border-neutral-700 bg-transparent px-3 py-2 text-sm"}),(0,n.jsx)("input",{value:f.zip,onChange:e=>g({...f,zip:e.target.value}),placeholder:"ZIP",className:"rounded-md border border-neutral-300 dark:border-neutral-700 bg-transparent px-3 py-2 text-sm"})]})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-neutral-200/70 dark:border-neutral-800 p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Payment"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-neutral-500",children:"Mock payment: we’ll create an order and instantly confirm a fake payment."})]})]}),(0,n.jsxs)("aside",{className:"h-fit rounded-xl border border-neutral-200/70 dark:border-neutral-800 p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Summary"}),(0,n.jsx)("ul",{className:"mt-4 space-y-2 text-sm",children:c.map(e=>(0,n.jsxs)("li",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("span",{className:"truncate",children:[e.title," \xd7 ",e.qty]}),(0,n.jsxs)("span",{children:["₹",((e.price||0)*(e.qty||0)).toLocaleString("en-IN")]})]},e.slug))}),(0,n.jsx)("div",{className:"mt-4 border-t border-neutral-200 dark:border-neutral-800"}),(0,n.jsxs)("div",{className:"mt-4 flex items-center justify-between font-semibold",children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsxs)("span",{children:["₹",p.toLocaleString("en-IN")]})]}),(0,n.jsx)(s.Z,{className:"mt-6 w-full",variant:"solid",disabled:h,onClick:k,children:h?"Placing...":"Place order & pay"})]})]})]})}},4385:function(e,r,t){"use strict";t.d(r,{AU:function(){return s},Ju:function(){return l},LV:function(){return a}});var n=t(452);async function a(e){let{data:r}=await n.Z.post("/orders",e||{});return r}async function s(){let{data:e}=await n.Z.get("/orders");return e}async function l(e){let{data:r}=await n.Z.get("/orders/".concat(e));return r}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5338)}),_N_E=e.O()}]);