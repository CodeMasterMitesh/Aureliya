(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{9026:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/branches",function(){return n(6591)}])},6591:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var a=n(5893),o=n(7294),r=n(1163),i=n(6455),l=n.n(i),s=n(7073),c=n(5710),d=n(9559),u=n(6656),h=n(8384),m=n(3281),f=n(6088);function p(){let e=(0,r.useRouter)(),t=(0,m.a)(e=>e.token),[n,i]=(0,o.useState)([]),[p,b]=(0,o.useState)(1),[v,x]=(0,o.useState)(1),[y,w]=(0,o.useState)(0),[g]=(0,o.useState)(20),[C,k]=(0,o.useState)(""),[B,j]=(0,o.useState)(""),[N,S]=(0,o.useState)(""),[_,P]=(0,o.useState)(""),[E,Z]=(0,o.useState)([]),[A,D]=(0,o.useState)(!0),[F,L]=(0,o.useState)(null),[M,T]=(0,o.useState)(!1),[H,Y]=(0,o.useState)(new Set);async function z(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p;D(!0);try{let{items:e,pages:n,total:a,page:o}=await (0,f.Pz)({page:t,limit:g,search:C,name:B||void 0,code:N||void 0,company:_||void 0});i(e),x(n),w(a),b(o),Y(new Set)}catch(a){var n;let t=null==a?void 0:null===(n=a.response)||void 0===n?void 0:n.status;(401===t||403===t)&&e.replace("/admin/login"),await l().fire({icon:"error",title:"Error",text:"Failed to load branches. Please try again.",confirmButtonColor:"#3b82f6"})}finally{D(!1)}}(0,o.useEffect)(()=>{t||e.replace("/admin/login")},[t]),(0,o.useEffect)(()=>{(0,f.Ao)("").then(Z)},[]),(0,o.useEffect)(()=>{z(1)},[C,B,N,_]);let O=e=>{L(e),T(!0)},R=async e=>{if((await l().fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await (0,f.NA)(e),await l().fire({icon:"success",title:"Deleted!",text:"Branch has been deleted.",timer:2e3,showConfirmButton:!1}),z(p)}catch(e){var t,n;await l().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to delete branch.",confirmButtonColor:"#3b82f6"})}},U=async e=>{if((await l().fire({title:"Are you sure?",text:"You are about to delete ".concat(e.length," branch(es). This action cannot be undone!"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete ".concat(e.length," item(s)!")})).isConfirmed)try{await (0,f.Di)(e),await l().fire({icon:"success",title:"Deleted!",text:"".concat(e.length," branch(es) have been deleted."),timer:2e3,showConfirmButton:!1}),z(p)}catch(e){var t,n;await l().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to delete branches.",confirmButtonColor:"#3b82f6"})}},W=async e=>{try{F?(await (0,f.o_)(F._id,e),await l().fire({icon:"success",title:"Updated!",text:"Branch has been updated successfully.",timer:2e3,showConfirmButton:!1})):(await (0,f.Qj)(e),await l().fire({icon:"success",title:"Created!",text:"Branch has been created successfully.",timer:2e3,showConfirmButton:!1})),T(!1),L(null),z(1)}catch(e){var t,n;await l().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to save branch.",confirmButtonColor:"#3b82f6"})}},q=(0,o.useMemo)(()=>[{key:"company",label:"Company",render:e=>(null==e?void 0:e.name)||""},{key:"name",label:"Name"},{key:"code",label:"Code"},{key:"address",label:"Address"}],[]),I=(0,o.useMemo)(()=>[{key:"company",label:"Company",type:"select",required:!0,options:E.map(e=>({value:e._id,label:e.name})),placeholder:"Select company"},{key:"name",label:"Name",required:!0,placeholder:"Enter branch name"},{key:"code",label:"Code",placeholder:"Enter branch code"},{key:"address",label:"Address",type:"textarea",rows:4,placeholder:"Enter branch address"}],[E]),Q=(0,o.useMemo)(()=>[{title:"Branch Information",fields:I}],[I]),X=(0,o.useMemo)(()=>[{key:"company",label:"Company",type:"select",value:_,options:[{value:"",label:"All Companies"},...E.map(e=>({value:e._id,label:e.name}))]},{key:"name",label:"Name",type:"text",value:B,placeholder:"Filter by name"},{key:"code",label:"Code",type:"text",value:N,placeholder:"Filter by code"}],[_,B,N,E]);return t?(0,a.jsxs)("div",{className:"min-h-screen flex bg-gray-50",children:[(0,a.jsx)(s.Z,{}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsx)(c.Z,{}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)(h.Z,{items:[{label:"Dashboard",href:"/admin/dashboard",icon:"\uD83C\uDFE0"},{label:"Branches"}]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Branches"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your branches"})]}),(0,a.jsxs)("button",{onClick:()=>{L(null),T(!0)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Branch"]})]}),(0,a.jsx)(d.Z,{title:"Branches",columns:q,data:n,loading:A,pagination:{page:p,pages:v,total:y,limit:g},onPageChange:e=>{b(e),z(e)},filters:X,onFilterChange:(e,t)=>{"company"===e?P(t):"name"===e?j(t):"code"===e&&S(t)},selectable:!0,selectedIds:H,onToggleRow:(e,t)=>{let n=new Set(H);t?n.add(e._id):n.delete(e._id),Y(n)},onToggleAll:e=>{e?Y(new Set(n.map(e=>e._id))):Y(new Set)},onBulkDelete:U,exportFileName:"branches",showSearch:!0,searchPlaceholder:"Search branches...",actions:e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>O(e),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit"]}),(0,a.jsxs)("button",{onClick:()=>R(e._id),className:"px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})})]})]}),(0,a.jsx)(u.Z,{isOpen:M,onClose:()=>{T(!1),L(null)},onSubmit:W,title:F?"Edit Branch":"Add New Branch",sections:Q,initialData:(()=>{if(F){var e;return{company:(null===(e=F.company)||void 0===e?void 0:e._id)||F.company||"",name:F.name||"",code:F.code||"",address:F.address||""}}return{company:_||"",name:"",code:"",address:""}})(),submitLabel:F?"Update Branch":"Create Branch"})]}):null}},6088:function(e,t,n){"use strict";n.d(t,{Ao:function(){return o},Di:function(){return p},NA:function(){return f},Pz:function(){return l},Qj:function(){return h},ZU:function(){return i},e5:function(){return s},j1:function(){return c},oR:function(){return d},o_:function(){return m},oe:function(){return r},xC:function(){return u}});var a=n(452);let o=async e=>{try{let{data:t}=await a.ZP.get("/companies",{params:{search:e,limit:200}});return t.items}catch(e){return[]}},r=async e=>{if(!e)return[];try{let{data:t}=await a.ZP.get("/companies/".concat(e,"/branches"));return t.items}catch(e){return[]}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await a.ZP.get("/companies",{params:e});return t},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await a.ZP.get("/branches",{params:e});return t},s=e=>a.ZP.post("/companies",e),c=(e,t)=>a.ZP.put("/companies/".concat(e),t),d=e=>a.ZP.delete("/companies/".concat(e)),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.ZP.delete("/companies",{data:{ids:e}})},h=e=>a.ZP.post("/branches",e),m=(e,t)=>a.ZP.put("/branches/".concat(e),t),f=e=>a.ZP.delete("/branches/".concat(e)),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.ZP.delete("/branches",{data:{ids:e}})}}},function(e){e.O(0,[166,251,664,738,56,888,774,179],function(){return e(e.s=9026)}),_N_E=e.O()}]);