(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[377],{1245:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/masters/accounts/ledger",function(){return n(9414)}])},9414:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var a=n(5893),l=n(7294),o=n(1163),r=n(6455),i=n.n(r),s=n(7073),c=n(5710),d=n(9559),u=n(6656),m=n(8384),p=n(3281),b=n(452);let g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await b.ZP.get("/ledgers",{params:e});return t},f=e=>b.ZP.post("/ledgers",e),y=(e,t)=>b.ZP.put("/ledgers/".concat(e),t),h=e=>b.ZP.delete("/ledgers/".concat(e)),_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return b.ZP.delete("/ledgers",{data:{ids:e}})};var v=n(7284);n(6088);let k=[{key:"ledger_type",label:"Ledger Type"},{key:"category",label:"Category"},{key:"alias_name",label:"Alias Name"},{key:"registration_type",label:"Registration Type"},{key:"gstin",label:"GSTIN"},{key:"pan_no",label:"PAN"},{key:"birth_date",label:"Birth Date",type:"date"},{key:"swift_code",label:"SWIFT Code"},{key:"ifsc_code",label:"IFSC Code"},{key:"bank_name",label:"Bank Name"},{key:"branch_name",label:"Bank Branch Name"},{key:"account_no",label:"Account No"},{key:"tan_no",label:"TAN No"},{key:"country",label:"Country"},{key:"tds_percentage",label:"TDS %",type:"number",step:.01},{key:"address_line1",label:"Address Line 1"},{key:"address_line2",label:"Address Line 2"},{key:"address_line3",label:"Address Line 3"},{key:"address_line4",label:"Address Line 4"},{key:"address_line5",label:"Address Line 5"},{key:"area",label:"Area"},{key:"city",label:"City"},{key:"pincode",label:"Pincode"},{key:"state",label:"State"},{key:"contact_person_name",label:"Contact Person"},{key:"contact_person_number",label:"Contact Number"},{key:"credit_period_days",label:"Credit Period (days)",type:"number"},{key:"is_rcm_applicable",label:"RCM Applicable",type:"checkbox"},{key:"is_msme_registered",label:"MSME Registered",type:"checkbox"}];function x(){let e=(0,o.useRouter)(),t=(0,p.a)(e=>e.user),[n,r]=(0,l.useState)([]),[b,x]=(0,l.useState)(1),[w,C]=(0,l.useState)(1),[N,S]=(0,l.useState)(0),[P]=(0,l.useState)(20),[j,A]=(0,l.useState)(""),[B,Z]=(0,l.useState)(""),[L,E]=(0,l.useState)([]),[T,M]=(0,l.useState)(!0),[D,F]=(0,l.useState)(null),[I,G]=(0,l.useState)(!1),[O,R]=(0,l.useState)(new Set),H=(null==t?void 0:t.company)||"",Y=(null==t?void 0:t.branch)||"";async function W(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;M(!0);try{let{items:e,pages:n,total:a,page:l}=await g({page:t,limit:P,search:j,company:H||void 0,branch:Y||void 0,account_group_id:B||void 0});r(e),C(n),S(a),x(l),R(new Set)}catch(a){var n;let t=null==a?void 0:null===(n=a.response)||void 0===n?void 0:n.status;(401===t||403===t)&&e.replace("/admin/login"),await i().fire({icon:"error",title:"Error",text:"Failed to load ledgers. Please try again.",confirmButtonColor:"#3b82f6"})}finally{M(!1)}}(0,l.useEffect)(()=>{(async()=>{try{let{items:e}=await (0,v.NB)({limit:200,company:H||void 0,branch:Y||void 0});E(e)}catch(e){console.error("Failed to load account groups:",e),E([])}})()},[H,Y]),(0,l.useEffect)(()=>{W(1)},[j,B,H,Y]);let q=e=>{F(e),G(!0)},U=async e=>{if((await i().fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await h(e),await i().fire({icon:"success",title:"Deleted!",text:"Ledger has been deleted.",timer:2e3,showConfirmButton:!1}),W(b)}catch(e){var t,n;await i().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to delete ledger.",confirmButtonColor:"#3b82f6"})}},z=async e=>{if((await i().fire({title:"Are you sure?",text:"You are about to delete ".concat(e.length," ledger(s). This action cannot be undone!"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete ".concat(e.length," item(s)!")})).isConfirmed)try{await _(e),await i().fire({icon:"success",title:"Deleted!",text:"".concat(e.length," ledger(s) have been deleted."),timer:2e3,showConfirmButton:!1}),W(b)}catch(e){var t,n;await i().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to delete ledgers.",confirmButtonColor:"#3b82f6"})}},V=async e=>{try{let t={...e},n={};if(Object.keys(t).forEach(e=>{let a=t[e];if(void 0!==a){if(""===a||null===a){"title"===e&&(n[e]=a);return}if(["tds_percentage","credit_period_days"].includes(e)){let t=Number(a);isNaN(t)||(n[e]=t);return}if("birth_date"===e&&a){n[e]=new Date(a);return}if(["is_active","is_rcm_applicable","is_msme_registered"].includes(e)){n[e]=!!a;return}n[e]=a}}),Object.assign(t,n),H&&""!==String(H).trim()&&(t.company=String(H)),Y&&""!==String(Y).trim()&&(t.branch=String(Y)),t.account_group_id&&""!==t.account_group_id.trim()){let e=L.find(e=>e._id===t.account_group_id);e&&(t.account_group_name=e.name)}else delete t.account_group_id,delete t.account_group_name;""!==t.email&&t.email||delete t.email,D?(await y(D._id,t),await i().fire({icon:"success",title:"Updated!",text:"Ledger has been updated successfully.",timer:2e3,showConfirmButton:!1})):(await f(t),await i().fire({icon:"success",title:"Created!",text:"Ledger has been created successfully.",timer:2e3,showConfirmButton:!1})),G(!1),F(null),W(1)}catch(o){var t,n,a,l;let e=(null==o?void 0:null===(n=o.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.errors)?o.response.data.errors.map(e=>"".concat(e.path,": ").concat(e.msg)).join(", "):(null==o?void 0:null===(l=o.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Failed to save ledger.";await i().fire({icon:"error",title:"Error",text:e,confirmButtonColor:"#3b82f6"})}},X=(0,l.useMemo)(()=>[{key:"title",label:"Title"},{key:"account_group_name",label:"Group"},{key:"email",label:"Email"},{key:"mobile_no",label:"Mobile"},{key:"gstin",label:"GSTIN"},{key:"pan_no",label:"PAN"},{key:"is_active",label:"Active",render:e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e?"Yes":"No"})}],[]),Q=(0,l.useMemo)(()=>[{key:"type",label:"Type",type:"select",required:!0,options:[{value:"employee",label:"Employee"},{value:"customer",label:"Customer"},{value:"supplier",label:"Supplier"},{value:"bank",label:"Bank"},{value:"cash",label:"Cash"},{value:"other",label:"Other"}],placeholder:"Select Type"},{key:"account_group_id",label:"Account Group",type:"select",required:!0,options:L.map(e=>({value:e._id,label:e.name})),placeholder:"Select Account Group"},{key:"title",label:"Title",required:!0,placeholder:"Enter title"},{key:"email",label:"Email",type:"email",placeholder:"Enter email"},{key:"mobile_no",label:"Mobile",placeholder:"Enter mobile number"},{key:"is_active",label:"Active",type:"checkbox",checkboxLabel:"Mark as active",defaultValue:!0},...k.map(e=>({key:e.key,label:e.label,type:e.type||"text",step:e.step,placeholder:"Enter ".concat(e.label.toLowerCase())}))],[L]),J=(0,l.useMemo)(()=>[{title:"Basic Information",fields:Q.slice(0,8)},{title:"Additional Details",fields:Q.slice(8,16)},{title:"Bank Details",fields:Q.slice(16,23)},{title:"Address Information",fields:Q.slice(23,31)},{title:"Other Information",fields:Q.slice(31)}],[Q]),K=(0,l.useMemo)(()=>[{key:"account_group_id",label:"Account Group",type:"select",value:B,options:[{value:"",label:"All Groups"},...L.map(e=>({value:e._id,label:e.name}))]}],[B,L]);return(0,a.jsxs)("div",{className:"min-h-screen flex bg-gray-50",children:[(0,a.jsx)(s.Z,{}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsx)(c.Z,{}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)(m.Z,{items:[{label:"Dashboard",href:"/admin/dashboard",icon:"\uD83C\uDFE0"},{label:"Masters",href:"/admin/masters"},{label:"Accounts",href:"/admin/masters/accounts"},{label:"Ledgers"}]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Ledgers"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your ledger accounts"})]}),(0,a.jsxs)("button",{onClick:()=>{F(null),G(!0)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Ledger"]})]}),(0,a.jsx)(d.Z,{title:"Ledgers",columns:X,data:n,loading:T,pagination:{page:b,pages:w,total:N,limit:P},onPageChange:e=>{x(e),W(e)},filters:K,onFilterChange:(e,t)=>{"account_group_id"===e&&Z(t)},selectable:!0,selectedIds:O,onToggleRow:(e,t)=>{let n=new Set(O);t?n.add(e._id):n.delete(e._id),R(n)},onToggleAll:e=>{e?R(new Set(n.map(e=>e._id))):R(new Set)},onBulkDelete:z,exportFileName:"ledgers",showSearch:!0,searchPlaceholder:"Search ledgers...",actions:e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>q(e),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit"]}),(0,a.jsxs)("button",{onClick:()=>U(e._id),className:"px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})})]})]}),(0,a.jsx)(u.Z,{isOpen:I,onClose:()=>{G(!1),F(null)},onSubmit:V,title:D?"Edit Ledger":"Add New Ledger",sections:J,initialData:(()=>{if(D){let e={type:D.type||"customer",title:D.title||"",email:D.email||"",mobile_no:D.mobile_no||"",account_group_id:D.account_group_id||"",is_active:!1!==D.is_active},t={};return k.forEach(e=>{var n;t[e.key]=null!==(n=D[e.key])&&void 0!==n?n:"number"===e.type?0:"checkbox"!==e.type&&""}),{...e,...t}}return{type:"customer",title:"",email:"",mobile_no:"",account_group_id:"",is_active:!0}})(),submitLabel:D?"Update Ledger":"Create Ledger"})]})}},7284:function(e,t,n){"use strict";n.d(t,{H3:function(){return r},NB:function(){return l},iC:function(){return s},o:function(){return i},yZ:function(){return o}});var a=n(452);let l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await a.ZP.get("/account-groups",{params:e});return t},o=e=>a.ZP.post("/account-groups",e),r=(e,t)=>a.ZP.put("/account-groups/".concat(e),t),i=e=>a.ZP.delete("/account-groups/".concat(e)),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.ZP.delete("/account-groups",{data:{ids:e}})}},6088:function(e,t,n){"use strict";n.d(t,{Ao:function(){return l},Di:function(){return g},NA:function(){return b},Pz:function(){return i},Qj:function(){return m},ZU:function(){return r},e5:function(){return s},j1:function(){return c},oR:function(){return d},o_:function(){return p},oe:function(){return o},xC:function(){return u}});var a=n(452);let l=async e=>{try{let{data:t}=await a.ZP.get("/companies",{params:{search:e,limit:200}});return t.items}catch(e){return[]}},o=async e=>{if(!e)return[];try{let{data:t}=await a.ZP.get("/companies/".concat(e,"/branches"));return t.items}catch(e){return[]}},r=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await a.ZP.get("/companies",{params:e});return t},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t}=await a.ZP.get("/branches",{params:e});return t},s=e=>a.ZP.post("/companies",e),c=(e,t)=>a.ZP.put("/companies/".concat(e),t),d=e=>a.ZP.delete("/companies/".concat(e)),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.ZP.delete("/companies",{data:{ids:e}})},m=e=>a.ZP.post("/branches",e),p=(e,t)=>a.ZP.put("/branches/".concat(e),t),b=e=>a.ZP.delete("/branches/".concat(e)),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.ZP.delete("/branches",{data:{ids:e}})}}},function(e){e.O(0,[166,251,664,738,56,888,774,179],function(){return e(e.s=1245)}),_N_E=e.O()}]);